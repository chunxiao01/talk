import{q as S,y as v,k as M,r as m}from"./index.98dbb16a.js";import{r as j,g as A,m as k}from"./request.f148b2fa.js";const s=S(),q=v("author",()=>({useauthor:M({author_id:s.useconfig.id,author_nickname:s.useconfig.nickname||s.useconfig.owner,author_motto:s.useconfig.motto,author_name:s.useconfig.owner,author_avatar_url:`https://avatars.githubusercontent.com/${s.useconfig.owner}?size=64`,author_url:`https://github.com/${s.useconfig.owner}`,author_repo:`https://github.com/${s.useconfig.owner}/${s.useconfig.repo}`,author_website_url:`https://${s.useconfig.owner}.github.io/${s.useconfig.repo}`,show_friend:s.useconfig.show_friend,friends_id:s.useconfig.friends_id,friends_name:s.useconfig.friends_name})})),t=S(),D=v("moment",()=>({usemoment:M({moment_title:t.useconfig.moment_name,moment_url:`https://${t.useconfig.owner}.github.io/${t.useconfig.repo}`,moment_pub_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/issues`,moment_new_post_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/issues/new/choose`,moment_config_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/blob/main/src/common/constants/config.js`,moment_manifest_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/blob/main/manifest.json`,moment_help_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/blob/main/README.md`,moment_aboutme_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/blob/main/About.md`,moment_api_url:`https://api.github.com/repos/${t.useconfig.owner}/${t.useconfig.repo}/issues`,moment_per_page:t.useconfig.per_page,moment_filter:"created",moment_state:t.useconfig.state,moment_author_type:t.useconfig.moment_author_type})}));function x(a,i,f,h,_){return j({url:a,method:"get",params:{page:i,per_page:f,filter:h,state:_}})}const o=q(),u=D(),z=v("momentdata",()=>{const a=m([]),i=m([]),f=m(0),h=m(1),_=m(0),g=m(!1),d=m(!1),p=m(!1),w=async()=>{try{const n=await x(u.usemoment.moment_api_url,1,u.usemoment.moment_per_page,u.usemoment.moment_filter,u.usemoment.moment_state);y(n.data,!1)}catch(n){console.log(n)}},L=async()=>{try{const n=await x(u.usemoment.moment_api_url,parseInt(h.value)+1,u.usemoment.moment_per_page,u.usemoment.moment_filter,u.usemoment.moment_state);y(n.data,!0)}catch(n){console.log(n)}},O=async()=>{await w()},y=(n,$)=>{if(Array.isArray(n)&&n.length>0){if(o.useauthor.author_show_friend&&Array.isArray(o.useauthor.friends_id)&&o.useauthor.friends_id.length>0?a.value=n.filter(r=>(r.author_association===u.usemoment.moment_author_type||o.useauthor.friends_id.includes(r.user.login))&&r.state===u.usemoment.moment_state):a.value=n.filter(r=>r.author_association===u.usemoment.moment_author_type&&r.state===u.usemoment.moment_state),a.value.length>0){if($){const r=[];a.value.forEach(e=>{let l=o.useauthor.author_nickname;o.useauthor.friends_id.indexOf(e.user.login)>-1&&Array.isArray(o.useauthor.friends_name)&&o.useauthor.friends_name.length===o.useauthor.friends_id.length&&(l=o.useauthor.friends_id.indexOf(e.user.login)>-1?o.useauthor.friends_name[o.useauthor.friends_id.indexOf(e.user.login)]:e.user.login);let c=!1;c=e.labels.some(b=>b.name==="\u97F3\u4E50"),r.push({moment_avatar_url:e.user.avatar_url,moment_author_nickname:l,moment_html_url:e.user.html_url,moment_login_user:e.user.login,moment_created_at_text:e.created_at,moment_created_at:A(e.created_at),moment_title:e.title,moment_body:k.parse(e.body?e.body:""),moment_is_music:c,moment_isshowpic:!1})}),P(),i.value.push(...r),d.value=!0}else if(a.value[0].number!==_.value||!_.value){const r=[];a.value.forEach(e=>{let l=o.useauthor.author_nickname;o.useauthor.friends_id.indexOf(e.user.login)>-1&&Array.isArray(o.useauthor.friends_name)&&o.useauthor.friends_name.length===o.useauthor.friends_id.length&&(l=o.useauthor.friends_id.indexOf(e.user.login)>-1?o.useauthor.friends_name[o.useauthor.friends_id.indexOf(e.user.login)]:e.user.login);let c=!1;c=e.labels.some(b=>b.name==="\u97F3\u4E50"),r.push({moment_avatar_url:e.user.avatar_url,moment_author_nickname:l,moment_html_url:e.user.html_url,moment_login_user:e.user.login,moment_created_at_text:e.created_at,moment_created_at:A(e.created_at),moment_title:e.title,moment_body:k.parse(e.body?e.body:""),moment_is_music:c,moment_isshowpic:!1})}),E(a.value[0].number),i.value=r,g.value=!0}else g.value=!1;f.value=i.value.length}}else $&&(d.value=!1);p.value||(p.value=!0)},E=n=>{_.value=n},P=()=>{h.value++};return{momentlist:i,moments_total_num:f,isPollDownUpdated:g,isPollUpLoadMore:d,isLoaded:p,getMomentList:w,getMomentListLoadMore:L,getMomentListRefresh:O}},{persist:{paths:["moments_total_num"]}});export{D as a,q as b,z as u};
