import{y as $,G as A,m as E,r as _}from"./index-a2e94391.js";import{T as I,e as M,m as O}from"./request-982c1355.js";const a=$(),j=A("author",()=>({useauthor:E({author_id:a.useconfig.id,author_nickname:a.useconfig.nickname||a.useconfig.owner,author_motto:a.useconfig.motto,author_name:a.useconfig.owner,author_avatar_url:`https://avatars.githubusercontent.com/${a.useconfig.owner}?size=64`,author_url:`https://github.com/${a.useconfig.owner}`,author_repo:`https://github.com/${a.useconfig.owner}/${a.useconfig.repo}`,author_website_url:`https://${a.useconfig.owner}.github.io/${a.useconfig.repo}`,show_friend:a.useconfig.show_friend,friends_id:a.useconfig.friends_id,friends_name:a.useconfig.friends_name})})),t=$(),T=A("moment",()=>({usemoment:E({moment_title:t.useconfig.moment_name,moment_url:`https://${t.useconfig.owner}.github.io/${t.useconfig.repo}`,moment_pub_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/issues`,moment_new_post_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/issues/new/choose`,moment_config_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/blob/main/src/common/constants/config.js`,moment_manifest_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/blob/main/manifest.json`,moment_help_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/blob/main/README.md`,moment_aboutme_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/blob/main/About.md`,moment_api_url:`https://api.github.com/repos/${t.useconfig.owner}/${t.useconfig.repo}/issues`,moment_per_page:t.useconfig.per_page,moment_filter:"created",moment_state:t.useconfig.state,moment_author_type:t.useconfig.moment_author_type})}));$();new I({baseURL:"",timeout:1e4});const z=new I({baseURL:"",timeout:1e4});function R(s){return z.get({url:s.url,params:{page:s.page,per_page:s.per_page,filter:s.filter,state:s.state},interceptors:{requestInterceptor(n){return n},requestInterceptorCatch(n){return n},responseInterceptor(n){return n},responseInterceptorCatch(n){return n}}})}function q(s){const n=/\<img/,p=/([\w\W]*)(title="null">)/;return s.replace(n,"<div><img").replace(p,'$1title="null"></div>')}const o=j(),i=T(),W=A("momentdata",()=>{const s=_([]),n=_([]),p=_(0),x=_(1),b=_(0),v=_(!1),w=_(!1),y=_(!1),S=async()=>{try{const r=await R({url:i.usemoment.moment_api_url,page:1,per_page:i.usemoment.moment_per_page,filter:i.usemoment.moment_filter,state:i.usemoment.moment_state});k(r.data,!1)}catch(r){console.log(r)}},U=async()=>{try{const r=await R({url:i.usemoment.moment_api_url,page:x.value+1,per_page:i.usemoment.moment_per_page,filter:i.usemoment.moment_filter,state:i.usemoment.moment_state});k(r.data,!0)}catch(r){console.log(r)}},C=async()=>{await S()},k=(r,L)=>{if(Array.isArray(r)&&r.length>0){if(o.useauthor.show_friend&&Array.isArray(o.useauthor.friends_id)&&o.useauthor.friends_id.length>0?s.value=r.filter(u=>{var e;return(u.author_association===i.usemoment.moment_author_type||o.useauthor.friends_id.includes((e=u.user)==null?void 0:e.login))&&u.state===i.usemoment.moment_state}):s.value=r.filter(u=>u.author_association===i.usemoment.moment_author_type&&u.state===i.usemoment.moment_state),s.value.length>0){if(L){const u=[];s.value.forEach(e=>{let g=o.useauthor.author_nickname;o.useauthor.friends_id.indexOf(e.user.login)>-1&&Array.isArray(o.useauthor.friends_name)&&o.useauthor.friends_name.length===o.useauthor.friends_id.length&&(g=o.useauthor.friends_id.indexOf(e.user.login)>-1?o.useauthor.friends_name[o.useauthor.friends_id.indexOf(e.user.login)]:e.user.login);let m=!1,l=!1,d=!1;const c=e.labels.some(h=>h.name==="音乐"),f=e.labels.some(h=>h.name==="视频");c&&f?d=!0:!c&&f?(m=!1,l=!0):c&&!f?(m=!0,l=!1):(m=!1,l=!1),u.push({moment_avatar_url:e.user.avatar_url,moment_author_nickname:g,moment_html_url:e.user.html_url,moment_login_user:e.user.login,moment_created_at_text:e.created_at,moment_created_at:M(e.created_at),moment_title:e.title,moment_body:q(O.parse(e.body?e.body:"")),moment_is_only_music:m,moment_is_only_video:l,moment_is_music_video:d,moment_isshowpic:!1})}),P(),n.value.push(...u),w.value=!0}else if(s.value[0].number!==b.value||!b.value){const u=[];s.value.forEach(e=>{let g=o.useauthor.author_nickname;o.useauthor.friends_id.indexOf(e.user.login)>-1&&Array.isArray(o.useauthor.friends_name)&&o.useauthor.friends_name.length===o.useauthor.friends_id.length&&(g=o.useauthor.friends_id.indexOf(e.user.login)>-1?o.useauthor.friends_name[o.useauthor.friends_id.indexOf(e.user.login)]:e.user.login);let m=!1,l=!1,d=!1;const c=e.labels.some(h=>h.name==="音乐"),f=e.labels.some(h=>h.name==="视频");c&&f?d=!0:!c&&f?(m=!1,l=!0):c&&!f?(m=!0,l=!1):(m=!1,l=!1),u.push({moment_avatar_url:e.user.avatar_url,moment_author_nickname:g,moment_html_url:e.user.html_url,moment_login_user:e.user.login,moment_created_at_text:e.created_at,moment_created_at:M(e.created_at),moment_title:e.title,moment_body:q(O.parse(e.body?e.body:"")),moment_is_only_music:m,moment_is_only_video:l,moment_is_music_video:d,moment_isshowpic:!1})}),D(s.value[0].number),n.value=u,v.value=!0}else v.value=!1;p.value=n.value.length}}else L&&(w.value=!1);y.value||(y.value=!0)},D=r=>{b.value=r},P=()=>{x.value++};return{momentlist:n,moments_total_num:p,isPollDownUpdated:v,isPollUpLoadMore:w,isLoaded:y,getMomentList:S,getMomentListLoadMore:U,getMomentListRefresh:C}},{persist:{paths:["moments_total_num"]}});export{T as a,j as b,W as u};
