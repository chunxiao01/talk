import{x as E,z as A,l as I,r as l}from"./index-7491aea8.js";import{r as z,g as k,m as L}from"./request-8a6dd9c8.js";const n=E(),D=A("author",()=>({useauthor:I({author_id:n.useconfig.id,author_nickname:n.useconfig.nickname||n.useconfig.owner,author_motto:n.useconfig.motto,author_name:n.useconfig.owner,author_avatar_url:`https://avatars.githubusercontent.com/${n.useconfig.owner}?size=64`,author_url:`https://github.com/${n.useconfig.owner}`,author_repo:`https://github.com/${n.useconfig.owner}/${n.useconfig.repo}`,author_website_url:`https://${n.useconfig.owner}.github.io/${n.useconfig.repo}`,show_friend:n.useconfig.show_friend,friends_id:n.useconfig.friends_id,friends_name:n.useconfig.friends_name})})),t=E(),R=A("moment",()=>({usemoment:I({moment_title:t.useconfig.moment_name,moment_url:`https://${t.useconfig.owner}.github.io/${t.useconfig.repo}`,moment_pub_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/issues`,moment_new_post_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/issues/new/choose`,moment_config_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/blob/main/src/common/constants/config.js`,moment_manifest_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/blob/main/manifest.json`,moment_help_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/blob/main/README.md`,moment_aboutme_url:`https://github.com/${t.useconfig.owner}/${t.useconfig.repo}/blob/main/About.md`,moment_api_url:`https://api.github.com/repos/${t.useconfig.owner}/${t.useconfig.repo}/issues`,moment_per_page:t.useconfig.per_page,moment_filter:"created",moment_state:t.useconfig.state,moment_author_type:t.useconfig.moment_author_type})}));function O(u,g,v,y,d){return z({url:u,method:"get",params:{page:g,per_page:v,filter:y,state:d},interceptors:{requestInterceptor(m){return m},requestInterceptorCatch(m){console.log(m)},responseInterceptor(m){return m},responseInterceptorCatch(m){console.log(m)}}})}const o=D(),a=R(),B=A("momentdata",()=>{const u=l([]),g=l([]),v=l(0),y=l(1),d=l(0),m=l(!1),w=l(!1),$=l(!1),x=async()=>{try{const s=await O(a.usemoment.moment_api_url,1,a.usemoment.moment_per_page,a.usemoment.moment_filter,a.usemoment.moment_state);S(s.data,!1)}catch(s){console.log(s)}},q=async()=>{try{const s=await O(a.usemoment.moment_api_url,y.value+1,a.usemoment.moment_per_page,a.usemoment.moment_filter,a.usemoment.moment_state);S(s.data,!0)}catch(s){console.log(s)}},C=async()=>{await x()},S=(s,M)=>{if(Array.isArray(s)&&s.length>0){if(o.useauthor.show_friend&&Array.isArray(o.useauthor.friends_id)&&o.useauthor.friends_id.length>0?u.value=s.filter(r=>{var e;return(r.author_association===a.usemoment.moment_author_type||o.useauthor.friends_id.includes((e=r.user)==null?void 0:e.login))&&r.state===a.usemoment.moment_state}):u.value=s.filter(r=>r.author_association===a.usemoment.moment_author_type&&r.state===a.usemoment.moment_state),u.value.length>0){if(M){const r=[];u.value.forEach(e=>{let p=o.useauthor.author_nickname;o.useauthor.friends_id.indexOf(e.user.login)>-1&&Array.isArray(o.useauthor.friends_name)&&o.useauthor.friends_name.length===o.useauthor.friends_id.length&&(p=o.useauthor.friends_id.indexOf(e.user.login)>-1?o.useauthor.friends_name[o.useauthor.friends_id.indexOf(e.user.login)]:e.user.login);let i=!1,_=!1,b=!1;const c=e.labels.some(h=>h.name==="音乐"),f=e.labels.some(h=>h.name==="视频");c&&f?b=!0:!c&&f?(i=!1,_=!0):c&&!f?(i=!0,_=!1):(i=!1,_=!1),r.push({moment_avatar_url:e.user.avatar_url,moment_author_nickname:p,moment_html_url:e.user.html_url,moment_login_user:e.user.login,moment_created_at_text:e.created_at,moment_created_at:k(e.created_at),moment_title:e.title,moment_body:L.parse(e.body?e.body:""),moment_is_only_music:i,moment_is_only_video:_,moment_is_music_video:b,moment_isshowpic:!1})}),j(),g.value.push(...r),w.value=!0}else if(u.value[0].number!==d.value||!d.value){const r=[];u.value.forEach(e=>{let p=o.useauthor.author_nickname;o.useauthor.friends_id.indexOf(e.user.login)>-1&&Array.isArray(o.useauthor.friends_name)&&o.useauthor.friends_name.length===o.useauthor.friends_id.length&&(p=o.useauthor.friends_id.indexOf(e.user.login)>-1?o.useauthor.friends_name[o.useauthor.friends_id.indexOf(e.user.login)]:e.user.login);let i=!1,_=!1,b=!1;const c=e.labels.some(h=>h.name==="音乐"),f=e.labels.some(h=>h.name==="视频");c&&f?b=!0:!c&&f?(i=!1,_=!0):c&&!f?(i=!0,_=!1):(i=!1,_=!1),r.push({moment_avatar_url:e.user.avatar_url,moment_author_nickname:p,moment_html_url:e.user.html_url,moment_login_user:e.user.login,moment_created_at_text:e.created_at,moment_created_at:k(e.created_at),moment_title:e.title,moment_body:L.parse(e.body?e.body:""),moment_is_only_music:i,moment_is_only_video:_,moment_is_music_video:b,moment_isshowpic:!1})}),P(u.value[0].number),g.value=r,m.value=!0}else m.value=!1;v.value=g.value.length}}else M&&(w.value=!1);$.value||($.value=!0)},P=s=>{d.value=s},j=()=>{y.value++};return{momentlist:g,moments_total_num:v,isPollDownUpdated:m,isPollUpLoadMore:w,isLoaded:$,getMomentList:x,getMomentListLoadMore:q,getMomentListRefresh:C}},{persist:{paths:["moments_total_num"]}});export{R as a,D as b,B as u};
